#: kivy 1.10.0

AttractorGame:


<AttractorGame>:
    id: game
    gameworld: gameworld

    GameWorld:
        id: gameworld
        gamescreenmanager: gamescreenmanager
        size_of_gameworld: 200 * 1024
        zones: {'general': 20000, 'touch': 1000}

        PositionSystem2D:
            system_id: 'position'
            gameworld: gameworld
            zones: ['general', 'touch']

        RotateSystem2D:
            system_id: 'rotate'
            gameworld: gameworld
            zones: ['general']

        CymunkPhysics:
            id: cymunk_physics
            system_id: 'cymunk_physics'
            gameworld: gameworld
            zones: ['general']

        AnimationSystem:
            id: animation
            system_id: 'animation'
            gameworld: gameworld
            updateable: True
            zones: ['general']

        RotateRenderer:
            id: rotate_renderer
            system_id: 'rotate_renderer'
            gameworld: gameworld
            frame_count: 2
            updateable: True
            force_update: False
            gameview: 'play_camera'
            shader_source: 'resources/shaders/p_r_shader.glsl'
            zones: ['general']

        GameMap:
            id: gamemap
            gameworld: gameworld
            map_size: 100 * 40, 100 * 40
            zones: ['general']

        GameView:
            id: play_camera
            system_id: 'play_camera'
            gameworld: gameworld
            currentmap: gamemap
            camera_scale: 3
            size: root.size
            window_size: root.size
            pos: root.pos
            updateable: True
            do_scroll: True
            do_scroll_lock: True
            focus_entity: True
            entity_to_focus: game.attractor_id
            touch_pass_through: True
            zones: ['general']

        ChargeSystem:
            system_id: 'charge'
            gameworld: gameworld
            zones: ['general']
            updateable: True

        LevelEditorSystem:
            system_id: 'editor'
            gameworld: gameworld
            zones: ['general']
            updateable: True

    GameScreenManager:
        id: gamescreenmanager
        gameworld: gameworld
        size: root.size
        pos: root.pos


<GameScreenManager>:
    MenuScreen:
        id: menu_screen

    PlayScreen:
        id: play_screen

    EditorScreen:
        id: editor_screen


<MenuScreen@GameScreen>:
    name: 'menu_screen'

    BoxLayout:
        orientation: 'vertical'
        padding: 10
        spacing: 10
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        size_hint: 0.4, 0.25

        Button:
            text: 'play'
            on_release: app.game.go_to_play_screen()

        Button:
            text: 'editor'
            on_release: app.game.go_to_editor_screen()


<PlayScreen@GameScreen>:
    name: 'play_screen'

    Button:
        size_hint: None, None
        size: 100, 40
        pos: 0, self.parent.height - 40
        text: "Menu"
        on_release: app.game.go_to_menu_screen()

    Button:
        size_hint: None, None
        size: 100, 40
        pos: self.parent.height - 100, self.parent.height - 40
        text: "Reset"
        on_release: app.game.reset_attractor()

    FloatLayout:
        Button:
            text: '+'
            pos_hint: {'x': 0, 'center_y': 0.5}
            size_hint: 0.1, 0.1
            on_release: app.game.change_attractor_charge('+')
            background_color: [0.1, 0.4, 0.4, 0.4]
        Button:
            text: '-'
            pos_hint: {'right': 1, 'center_y': 0.5}
            size_hint: 0.1, 0.1
            on_release: app.game.change_attractor_charge('-')
            background_color: [0.1, 0.4, 0.4, 0.4]
        Button:
            text: 'n'
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            size_hint: 0.1, 0.1
            on_release: app.game.change_attractor_charge('n')
            background_color: [0.1, 0.4, 0.4, 0.4]

<EditorScreen@GameScreen>:
    id: editor_screen
    name: 'editor_screen'

    Button:
        size_hint: None, None
        size: 100, 40
        pos: 0, self.parent.height - 40
        text: "Menu"
        on_release: app.game.go_to_menu_screen()

    Button:
        size_hint: None, None
        size: 100, 40
        pos: self.parent.height - 100, self.parent.height - 40
        text: "Reset"
        on_release: app.game.reset_attractor()

    # Grid settings
    BoxLayout:
        id: ui
        padding: 5
        spacing: 5
        size_hint: None, None
        orientation: 'horizontal'
        size: 800, 40
        pos: 0, 0

        canvas:
            Color:
                rgba: 0.12, 0.12, 0.12, 0.85

            Rectangle:
                size: self.size
                pos: self.pos

        Label:
            text: 'Grid:'

        TouchedTextBox:
            id: grid
            text: '10'

        ToggleButton:
            text: 'Delete'
            on_release: app.game.toggle_editor_deleting()

        Label:
            text: 'Level:'

        TouchedTextBox:
            id: level_name
            text: ''

        Button:
            text: 'Save'
            on_release: app.game.save_level()

        Button:
            text: 'Load'
            on_release: app.game.load_level()

        Label:
            text: 'Rot:'

        TouchedTextBox:
            id: rotation
            text: '0'
